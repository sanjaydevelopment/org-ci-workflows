name: Python Project Checklist

on:
  workflow_call:   # 👈 Makes it reusable
    inputs:
      project_folder:
        required: true
        type: string
        description: "Main project folder (e.g., AILogAnalyzer)"

jobs:
  checklist:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install tools
        run: |
          python -m pip install --upgrade pip
          pip install flake8 bandit

      # ✅ Check required files
      - name: Check required files
        run: |
          echo "🔍 Checking required files..."
          [ -f requirements.txt ] || (echo "❌ requirements.txt missing" && exit 1)
          [ -f README.md ] || (echo "❌ README.md missing" && exit 1)
          echo "✅ Required files found."

      # ✅ Check project structure
      - name: Check project structure
        run: |
          echo "🔍 Checking project structure..."
          [ -d ${{ inputs.project_folder }} ] || (echo "❌ Folder ${{ inputs.project_folder }}/ missing" && exit 1)
          [ -d tests ] || (echo "❌ tests/ folder missing" && exit 1)
          echo "✅ Project structure looks good."

      # ✅ Check for hardcoded values
      - name: Check for hardcoded secrets
        run: |
          echo "🔍 Scanning for hardcoded sensitive values..."
          if grep -i -E "password|secret|apikey|token|dbhost" -r ${{ inputs.project_folder }}/; then
            echo "❌ Hardcoded sensitive value found. Please use environment variables."
            exit 1
          fi
          echo "✅ No hardcoded sensitive values found."

      # ✅ Lint with flake8
      - name: Lint with flake8
        run: |
          echo "🔍 Running lint..."
          flake8 ${{ inputs.project_folder }} --max-line-length=100
          echo "✅ Lint passed."

      # ✅ Security scan with Bandit
      - name: Security check with Bandit
        run: |
          echo "🔍 Running Bandit security scan..."
          bandit -r ${{ inputs.project_folder }}
