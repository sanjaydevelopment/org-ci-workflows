name: Python Project Checklist

on:
  workflow_call:   # ğŸ‘ˆ Makes it reusable
    inputs:
      project_folder:
        required: true
        type: string
        description: "Main project folder (e.g., AILogAnalyzer)"

jobs:
  checklist:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install tools
        run: |
          python -m pip install --upgrade pip
          pip install flake8 bandit

      # âœ… Check required files
      - name: Check required files
        run: |
          echo "ğŸ” Checking required files..."
          [ -f requirements.txt ] || (echo "âŒ requirements.txt missing" && exit 1)
          [ -f README.md ] || (echo "âŒ README.md missing" && exit 1)
          echo "âœ… Required files found."

      # âœ… Check project structure
      - name: Check project structure
        run: |
          echo "ğŸ” Checking project structure..."
          [ -d ${{ inputs.project_folder }} ] || (echo "âŒ Folder ${{ inputs.project_folder }}/ missing" && exit 1)
          [ -d tests ] || (echo "âŒ tests/ folder missing" && exit 1)
          echo "âœ… Project structure looks good."

      # âœ… Check for hardcoded values
      - name: Check for hardcoded secrets
        run: |
          echo "ğŸ” Scanning for hardcoded sensitive values..."
          if grep -i -E "password|secret|apikey|token|dbhost" -r ${{ inputs.project_folder }}/; then
            echo "âŒ Hardcoded sensitive value found. Please use environment variables."
            exit 1
          fi
          echo "âœ… No hardcoded sensitive values found."

      # âœ… Lint with flake8
      - name: Lint with flake8
        run: |
          echo "ğŸ” Running lint..."
          flake8 ${{ inputs.project_folder }} --max-line-length=100
          echo "âœ… Lint passed."

      # âœ… Security scan with Bandit
      - name: Security check with Bandit
        run: |
          echo "ğŸ” Running Bandit security scan..."
          bandit -r ${{ inputs.project_folder }}
