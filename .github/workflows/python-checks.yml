name: Python Project Checklist

on:
  push:
    branches: ["main", "develop", "dev", "feature/*"]
  pull_request:

jobs:
  checklist:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install tools
        run: |
          python -m pip install --upgrade pip
          pip install flake8 bandit

      # ✅ Check for required project files
      - name: Check required files
        run: |
          echo "🔍 Checking required files..."
          [ -f requirements.txt ] || (echo "❌ requirements.txt missing" && exit 1)
          [ -f README.md ] || (echo "❌ README.md missing" && exit 1)
          echo "✅ Required files are present."

      # ✅ Check for project structure
      - name: Check project structure
        run: |
          echo "🔍 Checking project structure..."
          [ -d tests ] || (echo "❌ tests/ folder missing" && exit 1)
          [ -d AILogAnalyzer ] || (echo "❌ AILogAnalyzer/ folder missing" && exit 1)
          echo "✅ Project structure looks good."

      # ✅ Check for hardcoded values (simple scan)
      - name: Check for hardcoded secrets
        run: |
          echo "🔍 Scanning for hardcoded values..."
          if grep -i -E "password|secret|apikey|token|dbhost" -r AILogAnalyzer/; then
            echo "❌ Hardcoded sensitive value found. Please use environment variables."
            exit 1
          fi
          echo "✅ No hardcoded sensitive values found."

      # ✅ Run lint
      - name: Lint with flake8
        run: |
          echo "🔍 Running flake8 lint..."
          flake8 AILogAnalyzer --max-line-length=100
          echo "✅ Linting passed."

      # ✅ Security scan
      - name: Security check with Bandit
        run: |
          echo "🔍 Running Bandit security scan..."
          bandit -r AILogAnalyzer || (echo "❌ Security issues found!" && exit 1)
