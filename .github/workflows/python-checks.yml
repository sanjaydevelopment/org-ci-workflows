name: Python Project Checklist

on:
  push:
    branches: ["main", "develop", "dev", "feature/*"]
  pull_request:

jobs:
  checklist:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install tools
        run: |
          python -m pip install --upgrade pip
          pip install flake8 bandit

      # âœ… Check for required project files
      - name: Check required files
        run: |
          echo "ğŸ” Checking required files..."
          [ -f requirements.txt ] || (echo "âŒ requirements.txt missing" && exit 1)
          [ -f README.md ] || (echo "âŒ README.md missing" && exit 1)
          echo "âœ… Required files are present."

      # âœ… Check for project structure
      - name: Check project structure
        run: |
          echo "ğŸ” Checking project structure..."
          [ -d tests ] || (echo "âŒ tests/ folder missing" && exit 1)
          [ -d AILogAnalyzer ] || (echo "âŒ AILogAnalyzer/ folder missing" && exit 1)
          echo "âœ… Project structure looks good."

      # âœ… Check for hardcoded values (simple scan)
      - name: Check for hardcoded secrets
        run: |
          echo "ğŸ” Scanning for hardcoded values..."
          if grep -i -E "password|secret|apikey|token|dbhost" -r AILogAnalyzer/; then
            echo "âŒ Hardcoded sensitive value found. Please use environment variables."
            exit 1
          fi
          echo "âœ… No hardcoded sensitive values found."

      # âœ… Run lint
      - name: Lint with flake8
        run: |
          echo "ğŸ” Running flake8 lint..."
          flake8 AILogAnalyzer --max-line-length=100
          echo "âœ… Linting passed."

      # âœ… Security scan
      - name: Security check with Bandit
        run: |
          echo "ğŸ” Running Bandit security scan..."
          bandit -r AILogAnalyzer || (echo "âŒ Security issues found!" && exit 1)
