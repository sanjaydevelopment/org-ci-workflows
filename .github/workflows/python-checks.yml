name: Project Validation Checks
on:
  push:
    branches:
      - main
      - 'feature/**'
  pull_request:

jobs:
  validate_project:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Validate project structure
        run: |
          echo "Checking project structure..."
          REQUIRED_FILES=("README.md" "requirements.txt" "src" "tests")
          for file in "${REQUIRED_FILES[@]}"; do
            if [ ! -e "$file" ]; then
              echo "❌ Missing required file or folder: $file"
              exit 1
            fi
          done
          echo "✅ Project structure OK"

      - name: Validate requirements.txt
        run: |
          if [ ! -f "requirements.txt" ]; then
            echo "❌ requirements.txt not found!"
            exit 1
          fi
          # Optional: check for valid pip syntax
          pip install --dry-run -r requirements.txt || { echo "❌ Invalid requirements.txt"; exit 1; }
          echo "✅ requirements.txt is valid"

      - name: Check for hardcoded secrets
        run: |
          echo "Checking for hardcoded secrets..."
          if grep -rE "(API_KEY|PASSWORD|SECRET|TOKEN) *= *['\"]" ./src; then
            echo "❌ Hardcoded secret found! Please remove it."
            exit 1
          fi
          echo "✅ No hardcoded secrets detected"
