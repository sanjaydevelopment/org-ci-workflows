name: Python Project Checklist

on:
  workflow_call:
    inputs:
      project_folder:
        required: true
        type: string
        description: "Main project folder (e.g., AILogAnalyzer)"

jobs:
  checklist:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install tools
        run: |
          python -m pip install --upgrade pip
          pip install flake8 bandit

      # ‚úÖ Must pass
      - name: Check required files
        id: files
        run: |
          msg=""
          if [ ! -f requirements.txt ]; then msg="‚ùå requirements.txt missing"; fi
          if [ ! -f README.md ]; then msg="$msg\n‚ùå README.md missing"; fi
          if [ -n "$msg" ]; then echo -e "$msg"; exit 1; fi
          echo "‚úÖ Required files found."

      # ‚úÖ Must pass
      - name: Check project structure
        id: structure
        run: |
          msg=""
          if [ ! -d "${{ inputs.project_folder }}" ]; then msg="‚ùå Folder ${{ inputs.project_folder }}/ missing"; fi
          if [ ! -d tests ]; then msg="$msg\n‚ùå tests/ folder missing"; fi
          if [ -n "$msg" ]; then echo -e "$msg"; exit 1; fi
          echo "‚úÖ Project structure looks good."

      # ‚úÖ Must pass
      - name: Check for hardcoded values
        id: hardcode
        run: |
          if grep -i -E "password|secret|apikey|token|dbhost" -r ${{ inputs.project_folder }}/; then
            echo "‚ùå Hardcoded sensitive value found. Please use environment variables."
            exit 1
          fi
          echo "‚úÖ No hardcoded sensitive values found."

      # ‚ö†Ô∏è Optional
      - name: Lint with flake8 (non-blocking)
        id: lint
        continue-on-error: true
        run: |
          echo "üîç Running lint (non-blocking)..."
          flake8 ${{ inputs.project_folder }} --max-line-length=120
          if [ $? -ne 0 ]; then
            echo "‚ö†Ô∏è Linting issues found (not blocking workflow)."
          else
            echo "‚úÖ Lint passed."
          fi

      # ‚ö†Ô∏è Optional
      - name: Security check with Bandit (non-blocking)
        id: bandit
        continue-on-error: true
        run: |
          echo "üîç Running Bandit security scan (non-blocking)..."
          bandit -r ${{ inputs.project_folder }}
          if [ $? -ne 0 ]; then
            echo "‚ö†Ô∏è Security issues found (not blocking workflow)."
          else
            echo "‚úÖ Security scan passed."
          fi

      # ‚úÖ Final summary
      - name: Summary Report
        if: always()
        run: |
          echo "üìã Project Checklist Summary"
          echo "---------------------------"
          echo "Files Check:     ${{ steps.files.outcome }}"
          echo "Structure Check: ${{ steps.structure.outcome }}"
          echo "Hardcoded Scan:  ${{ steps.hardcode.outcome }}"
          echo "Lint Check:      ${{ steps.lint.outcome }} (non-blocking)"
          echo "Security Check:  ${{ steps.bandit.outcome }} (non-blocking)"
