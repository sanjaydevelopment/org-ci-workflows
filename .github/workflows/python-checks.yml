name: Python Checks

on:
  workflow_call:  # üëà allows other repos to call this workflow
    inputs:
      python-version:
        required: false
        type: string
        default: "3.11"

jobs:
  checks:
    runs-on: ubuntu-latest

    steps:
      # 1. ‚úÖ Checkout repo
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. ‚úÖ Set up Python
      - name: Set up Python ${{ inputs.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ inputs.python-version }}

      # 3. ‚úÖ Install dependencies (only if requirements.txt exists)
      - name: Install dependencies
        run: |
          if [ -f requirements.txt ]; then
            echo "Installing dependencies..."
            pip install -r requirements.txt
          else
            echo "‚ö†Ô∏è requirements.txt not found, skipping dependency install"
          fi

      # 4. ‚úÖ Lint with flake8
      - name: Run flake8 lint
        run: |
          pip install flake8
          echo "Running flake8..."
          flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
          flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics

      # 5. ‚úÖ Run pytest if tests/ directory exists
      - name: Run tests with pytest
        run: |
          pip install pytest
          if [ -d tests ]; then
            echo "Running pytest..."
            pytest -q --disable-warnings
          else
            echo "‚ö†Ô∏è No tests/ directory found, skipping pytest"
          fi
